# Financial

## Overview

The financial APIs provide the core financial functionality such as refunds, transactions and status.


You may Debit one of the following sources:


  * mWallet
  * mAccount
  * Australian Bank Account
  * Credit-Card (Refunds are supported, including partial)
  
  
You may Crebit one of the following sources:


  * mWallet
  * mAccount
  * Australian Bank Account
  * BPay
  
  
## Refund - Execute

> The above command returns JSON structured like this:

```json
{
  "transactionId":         number,
  "callerUniqueReference": string,
  "feeAmountExcludingGst": number,
  "feeAmountGstComponent": number,
  "feeAmountIncludingGst": number,
  "status":                string,
  "statusDescription":     string,
  "durationMs":            number
}
```

The purpose of the financial/v1/refund/execute API is to refund funds back on a Credit-Card that was used in a previousfinancial/v1/transaction/execute API call.


Funds are debited from the Sign-In mAccount then refunded back to the Credit-Card. It is your responsibility to ensure there are sufficient funds in your mAccount.

### HTTP Request

`POST http://example.com/financial/v1/refund/execute`

### Field Descriptions

Field Name | Type | Max Size | Description
--------- | ------- | ------ | -----------
\*uniqueReference | string | 200 | This is a unique reference generated by the calling service. This is a NONCE. Its use is to determine if a request has already been received by thePlatform.
printUniqueReferenceOnStatement | boolean | | If true, the UniqueReference will be printed on the statement. Default is false;
\*refundAmount | number | | This is the amount to be debited from the Sign-in mAccout then credited to the Credit-Card used in the original transaction
\*description | string | 500 | This description will be displayed on themWallet and mAccount statements. It  should be brief but contain sufficient information to identify the goods. E.g. "Flowers Refund. Inv#: 123456".
\*originalTransactionId | number | | This is the transactionId that was returned from the original Credit-Card transaction.

### Response Field Descriptions ###

Field Name | Type | Description
--------- | ------- | -----------
transactionId|number|This is the Platform ID that is unique to your refund request. 0 will be returned if any errors occurred. If theuniqueReference already exists, then this field will contain the previous transactionId, which could be 0.
callerUniqueReference | string | This is the unique reference that was passed in by the calling service
feeAmountExcludingGst | number | This is the fee amount Excluding GST that has been debited from your mAccount account
feeAmountGstComponent | number | This is the GST Component of the fee amount that has been debited from your mAccount
feeAmountIncludingGst | number | This is the total fee amount Including GST that has been debited from your mAccount
status | string | This is the status of executing the request. A code of ‘Ok’ indicates no errors. See the sectionStatus & Descriptions
statusDescription | string | This is a plain English description of the status. See the sectionStatus Description.
durationMs | number | This can be ignored. This value represents the total time in milliseconds that thePlatform took to process the request.


## Refund - Validate

> The above command returns JSON structured like this:

```json
{
  "transactionId":         number,
  "callerUniqueReference": string,
  "feeAmountExcludingGst": number,
  "feeAmountGstComponent": number,
  "feeAmountIncludingGst": number,
  "status":                string,
  "statusDescription":     string,
  "durationMs":            number
}
```


The purpose of the refund/validate API is to determine if the parameters for the refund/execute API are correct. This API is optional although it does return the fees that will be returned.


### HTTP Request

`POST http://example.com/financial/v1/refund/validate`

### Request Body Field Descriptions

Field Name | Type | Max Size | Description
--------- | ------- | ------ | -----------
\*uniqueReference | string | 200 | This is a unique reference generated by the calling service. This is a NONCE. Its use is to determine if a request has already been received by thePlatform.
printUniqueReferenceOnStatement | boolean | | If true, the UniqueReference will be printed on the statement. Default is false;
\*refundAmount | number | | This is the amount to be debited from the Sign-in mAccout then credited to the Credit-Card used in the original transaction
\*description | string | 500 | This description will be displayed on themWallet and mAccount statements. It  should be brief but contain sufficient information to identify the goods. E.g. "Flowers Refund. Inv#: 123456".
\*originalTransactionId | number | | This is the transactionId that was returned from the original Credit-Card transaction.

### Response Field Descriptions ###

Field Name | Type | Description
--------- | ------- | -----------
transactionId|number|This is the Platform ID that is unique to your refund request. 0 will be returned if any errors occurred. If theuniqueReference already exists, then this field will contain the previous transactionId, which could be 0.
callerUniqueReference | string | This is the unique reference that was passed in by the calling service
feeAmountExcludingGst | number | This is the fee amount Excluding GST that has been debited from your mAccount account
feeAmountGstComponent | number | This is the GST Component of the fee amount that has been debited from your mAccount
feeAmountIncludingGst | number | This is the total fee amount Including GST that has been debited from your mAccount
status | string | This is the status of executing the request. A code of ‘Ok’ indicates no errors. See the sectionStatus & Descriptions
statusDescription | string | This is a plain English description of the status. See the sectionStatus Description.
durationMs | number | This can be ignored. This value represents the total time in milliseconds that thePlatform took to process the request.


## Status

> The above command returns JSON structured like this:

```json
{
  "dishonouredDate":   string,
  "transactionStatus": string
  "status":            string,
  "statusDescription": string,
  "durationMs":        number
}
```

Returns the status of a previous transaction; this is important because a directDebit transaction may be dishonoured up to 10 days after the transaction was executed.


See the section Callback Notification for a discussion on being notified when a directDebit transaction is dishonoured.

### HTTP Request

`GET http://example.com/financial/v1/status/{uniqueReference}`

### Request Parameters

Title | Description
---------- | ---------
uniqueReference | The unique reference provided by a successful execution of a financial transaction


## Transaction - Execute

> The above command returns JSON structured like this:

```json
{
  "transactionId":         number,
  "callerUniqueReference": string,
  "feeAmountExcludingGst": number,
  "feeAmountGstComponent": number,
  "feeAmountIncludingGst": number,
  "bpayReceipts":          [BpayReceiptItem],
  "feeBreakdown":          FeeBreakdownDetail,
  "status":                string,
  "statusDescription":     string,
  "durationMs":            number
}
```


The purpose of the execute API is to debit a source for funds then distribute those funds to one or more supplied disbursement accounts. 


You can use the Transaction/validate API to determine if the parameters are correct.


### HTTP Request

`POST http://example.com/financial/v1/transaction/execute`

### Request Body Schema

```json
{
  "uniqueReference":                 string, 
  "printUniqueReferenceOnStatement": boolean,
  "totalAmount":                     number,
  "description":                     string,
  "paymentSource":                   string,
  "token":                           string,
  "creditCard":                      CreditCardDetails,
  "mWallet":                         MWalletDetails,
  "mAccount":                        MAccountDetails,
  "directDebit":                     AustralianBankAccount,
  "midToken":                        string,
  "ignoreCardTypes":                 [string],
  "disbursements":                   [
                                       MAccountDisbursementItem,
                                       DirectCreditDisbursementItem,
                                       BpayDisbursementItem,
                                       TokenDisbursementItem
                                     ]
}
```


### Response Field Descriptions ###

Field Name | Type | Description
--------- | ------- | -----------
transactionId|number|This is the Platform ID that is unique to your refund request. 0 will be returned if any errors occurred. If theuniqueReference already exists, then this field will contain the previous transactionId, which could be 0.
callerUniqueReference | string | This is the unique reference that was passed in by the calling service
feeAmountExcludingGst | number | This is the fee amount Excluding GST that has been debited from your mAccount account
feeAmountGstComponent | number | This is the GST Component of the fee amount that has been debited from your mAccount
feeAmountIncludingGst | number | This is the total fee amount Including GST that has been debited from your mAccount
bpayReceipts | [BpayReceiptItem] | An array of BpayReceiptItem’s. Each BPAY disbursement will have an entry in this array with the unique receipt number. See the BpayReceiptItem section
feeBreakdown | FeeBreakdownDetail | Contains details fees for the Debit transaction and each disbursement.See the FeeBreakdownDetail section
status | string | This is the status of executing the request. A code of ‘Ok’ indicates no errors. See the sectionStatus & Descriptions
statusDescription | string | This is a plain English description of the status. See the sectionStatus Description.
durationMs | number | This can be ignored. This value represents the total time in milliseconds that thePlatform took to process the request.


## Transaction - Validate

> The above command returns JSON structured like this:

```json
{
  "transactionId":         number,
  "callerUniqueReference": string,
  "feeAmountExcludingGst": number,
  "feeAmountGstComponent": number,
  "feeAmountIncludingGst": number,
  "status":                string,
  "statusDescription":     string,
  "durationMs":            number
}
```


The purpose of the execute API is to debit a source for funds then distribute those funds to one or more supplied disbursement accounts. 


You can use the Transaction/validate API to determine if the parameters are correct.


### HTTP Request

`POST http://example.com/financial/v1/transaction/execute`

### Request Body Schema

```json
{
  "uniqueReference":                 string, 
  "printUniqueReferenceOnStatement": boolean,
  "totalAmount":                     number,
  "description":                     string,
  "paymentSource":                   string,
  "token":                           string,
  "creditCard":                      CreditCardDetails,
  "mWallet":                         MWalletDetails,
  "mAccount":                        MAccountDetails,
  "directDebit":                     AustralianBankAccount,
  "midToken":                        string,
  "ignoreCardTypes":                 [string],
  "disbursements":                   [
                                       MAccountDisbursementItem,
                                       DirectCreditDisbursementItem,
                                       BpayDisbursementItem,
                                       TokenDisbursementItem
                                     ]
}
```


### Response Field Descriptions ###

Field Name | Type | Description
--------- | ------- | -----------
transactionId|number|This is the Platform ID that is unique to your refund request. 0 will be returned if any errors occurred. If theuniqueReference already exists, then this field will contain the previous transactionId, which could be 0.
callerUniqueReference | string | This is the unique reference that was passed in by the calling service
feeAmountExcludingGst | number | This is the fee amount Excluding GST that has been debited from your mAccount account
feeAmountGstComponent | number | This is the GST Component of the fee amount that has been debited from your mAccount
feeAmountIncludingGst | number | This is the total fee amount Including GST that has been debited from your mAccount
status | string | This is the status of executing the request. A code of ‘Ok’ indicates no errors. See the sectionStatus & Descriptions
statusDescription | string | This is a plain English description of the status. See the sectionStatus Description.
durationMs | number | This can be ignored. This value represents the total time in milliseconds that thePlatform took to process the request.


## Financial Status Code Descriptions

This section documents the returned status codes for bothtransaction and refund APIs along with the default descriptions. Descriptions may not match exactly as in many cases the invalid value will be returned as part of the description. If the description contains an array[‘]’ the returned description will contain the actual index containing the error eg. ‘[2]’


### Transactions

Status Code | Description | HTTP Status
---------------| ----------| ----------
Ok|Operation completed successfully | 200
Unauthorized|Authentication Failure 401
Error| An unknown processing error occurred. Transaction has been cancelled | 400 
Exception | An unhandled Exception has occurred. Transaction has been cancelled | 400 
UniqueIdNotFound | The Unique ID was not found | 400 
RequestBodyNotValidJson | The request body was not valid JSON | 400 
UniqueReferenceExists | The uniqueReference already exists | 400 
UniqueReferenceExceedsMaxLength | The uniqueReference must not exceed 200 characters in length | 400 
InvalidTotalAmount | totalAmount must be greater than $0.00 and must be no more than two decimal places | 400 
InvalidDisbusrsmentAmount | disbursements[].amount must be greater than $0.00 and must be no more than two decimal places | 400
InvalidDescription | description must not be empty or null | 400
InvalidDescription |Maximum length of description is 300 characters | 400
InvalidDescriptionLength | disbursements[] collection must contain at least one item | 400 
InvalidDisbursementsCollection | disbursements[].amount must have a value greater than $0.00 | 400 
InvalidDisbursementItemAmount | When disbursements[].disbursementMethod equals 'mAccount' the toMAccount field must have a valid mAccount 16-Digit account number | 400
When disbursements[].disbursementMethod equals 'mAccount' and the mAccount is a Chariy, the Charity must be a vvalid for your Sign-In Account | 400
"When disbursements[].disbursementMethod equals 'mWallet' the mWallet field must have a valid mWallet 16-Digit account number | 400
InvalidDisbursementItemDirectCreditDetails | When disbursements[].disbursementMethod equals 'directCredit' the item must have a valid toDirectCreditDetails | 400
InvalidAmountsDontMatch | Sum of the disbursements[].amounts does not equal the totalAmount | 400 
ToAccountNotValidToTransact | The disbursements[].toMAccount is not valid to transact | 400

InvalidDisbursementItemToMAccount |
InvalidDisbursementItemToMAccountInvalidCharity |




